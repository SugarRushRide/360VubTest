import json
import os
import subprocess
import re

test_data = [
    # ("æœ¬çœå°±ä¸šç‡", "æ³‰å·èŒä¸šæŠ€æœ¯å¤§å­¦", "0.8966", "2023"),
    # ("æ¯•ä¸šå»å‘è½å®ç‡", "è¥¿å®‰ä¿¡æ¯èŒä¸šå¤§å­¦", "0.8608", "2022"),
    # ("æœ¬çœå°±ä¸šç‡ï¼ˆæœ¬ç§‘ï¼‰", "æ–°ç–†å¤©å±±èŒä¸šæŠ€æœ¯å¤§å­¦", "0.9023", "2023"),
    # ("æ¯•ä¸šç”Ÿæˆé•¿", "å—æ˜ŒèŒä¸šå¤§å­¦", "0.325", "2021"),
    # ("æŠ€æœ¯æœåŠ¡åˆ°æ¬¾", "æ²³å—ç§‘æŠ€èŒä¸šå¤§å­¦", "0", "2022"),
    # ("åŸ¹è®­æœåŠ¡åˆ°æ¬¾", "æ²³å—ç§‘æŠ€èŒä¸šå¤§å­¦", "22", "2022"),
    # ("ç•™å­¦ç”Ÿæ•°", "å±±ä¸œå¤–å›½è¯­èŒä¸šæŠ€æœ¯å¤§å­¦", "346", "2023"),
    # ("å…šå»ºå·¥ä½œç¤ºèŒƒå•ä½", "å±±ä¸œå¤–å›½è¯­èŒä¸šæŠ€æœ¯å¤§å­¦", "1", "2023"),
    # ("çœçº§è¯¾ç¨‹æ€æ”¿é¡¹ç›®", "å±±ä¸œå¤–å›½è¯­èŒä¸šæŠ€æœ¯å¤§å­¦", "3", "2023"),
    # ("æ¨¡èŒƒå…ˆè¿›å­¦ç”Ÿï¼ˆæŠ˜åˆæ•°ï¼‰", "é‡‘åèŒä¸šæŠ€æœ¯å¤§å­¦", "0", "2020"),
    # ("å›½å®¶çº§è¯¾ç¨‹æ€æ”¿é¡¹ç›®", "æµ™æ±Ÿæœºç”µèŒä¸šæŠ€æœ¯å¤§å­¦", "1", "2021"),
    # ("å…¨æ—¥åˆ¶åœ¨æ ¡ç”Ÿæ•°", "æ™¯å¾·é•‡è‰ºæœ¯èŒä¸šå¤§å­¦", "17644", "2023"),
    # ("å…¨æ—¥åˆ¶åœ¨æ ¡ç”Ÿæ•°", "åŒ—äº¬äº¤é€šèŒä¸šæŠ€æœ¯å­¦é™¢", "999", "2023"),
    # ("å…¨æ—¥åˆ¶åœ¨æ ¡ç”Ÿæ•°", "ä¸Šæµ·ä¸­ä¾¨èŒä¸šæŠ€æœ¯å¤§å­¦", "9316", "2023"),
    # 2025-4-1
    ("æœ¬çœå°±ä¸šç‡", "é½é½å“ˆå°”é«˜ç­‰å¸ˆèŒƒä¸“ç§‘å­¦æ ¡", "0.1835", "2023"),
    ("å­¦æ ¡æ€»æ”¶å…¥", "ç¦å»ºå¹¼å„¿å¸ˆèŒƒé«˜ç­‰ä¸“ç§‘å­¦æ ¡", "17174.97", "2023"),
    ("æ•™å¸ˆè§„æ¨¡", "å±±è¥¿è­¦å®˜èŒä¸šå­¦é™¢", "73", "2023"),
    ("æ•™å¸ˆèŒç§°ç»“æ„", "æ°‘åŠåˆè‚¥ç»æµæŠ€æœ¯èŒä¸šå­¦é™¢", "0.1458", "2023"),
    ("åŸ¹è®­æœåŠ¡åˆ°æ¬¾", "ç”˜è‚ƒé’¢é“èŒä¸šæŠ€æœ¯å­¦é™¢", "534.068", "2023"),
    ("åŒå¸ˆå‹æ•™å¸ˆæ¯”ä¾‹", "æ¼³å·ç†å·¥èŒä¸šå­¦é™¢", "0.3368", "2023"),
    ("æ¯•ä¸šç”Ÿæˆé•¿", "å–€ä»€èŒä¸šæŠ€æœ¯å­¦é™¢", "0", "2023"),
    ("åŸ¹è®­æœåŠ¡åˆ°æ¬¾", "æ¹–å—ç½‘ç»œå·¥ç¨‹èŒä¸šå­¦é™¢", "0", "2023"),
    ("é«˜æ°´å¹³ç§‘æŠ€è®ºæ–‡", "ä¸Šæµ·ä¸­ä¾¨èŒä¸šæŠ€æœ¯å¤§å­¦", "98", "2024"),
    ("é«˜æ°´å¹³ç§‘æŠ€è®ºæ–‡", "è¥¿å®‰ä¿¡æ¯èŒä¸šå¤§å­¦", "1", "2024"),
]

for data in test_data:
    indicator, school_name, value, year = data
    # è®¾ç½®ç¯å¢ƒå˜é‡
    os.environ["INDICATOR"] = indicator
    os.environ["SCHOOL_NAME"] = school_name
    os.environ["VALUE"] = value
    os.environ["YEAR"] = year
    # è¿è¡Œ pytest
    os.system('pytest test_data_accuracy.py -s')

# å­˜å‚¨æ‰€æœ‰æµ‹è¯•æŠ¥å‘Šçš„è·¯å¾„
# report_files = ["/test_report_files"]
#
# for index, data in enumerate(test_data, start=1):
#     indicator, school_name, value, year = data
#
#     # è®¾ç½®ç¯å¢ƒå˜é‡
#     os.environ["INDICATOR"] = indicator
#     os.environ["SCHOOL_NAME"] = school_name
#     os.environ["VALUE"] = value
#     os.environ["YEAR"] = year
#
#     # ç”Ÿæˆ HTML æŠ¥å‘Šçš„è·¯å¾„
#     report_file = os.path.join("/test_report_files", f"test_report_{index}.html")
#     report_files.append(report_file)
#
#     print(f"\nã€æ‰§è¡Œæµ‹è¯• {index}/{len(test_data)}ã€‘ï¼š{indicator} - {school_name}")
#
#     # è¿è¡Œ pytestï¼Œå¹¶ç”Ÿæˆç‹¬ç«‹çš„ HTML æŠ¥å‘Š
#     subprocess.run(
#         [
#             "pytest", "test_data_accuracy.py",
#             "--html=" + report_file,
#             "--self-contained-html",
#             "-s"
#         ]
#     )
#
# # ç”Ÿæˆç´¢å¼•é¡µ
# index_html_path = os.path.join("/test_report_files", "index.html")
# with open(index_html_path, "w", encoding="utf-8") as index_file:
#     index_file.write("<html><head><title>æµ‹è¯•æŠ¥å‘Šç´¢å¼•</title></head><body>")
#     index_file.write("<h1>æµ‹è¯•æŠ¥å‘Šç´¢å¼•</h1><ul>")
#
#     for report in report_files:
#         index_file.write(f'<li><a href="{os.path.basename(report)}">{os.path.basename(report)}</a></li>')
#
#     index_file.write("</ul></body></html>")
#
# print(f"\nğŸ“Š æµ‹è¯•å®Œæˆï¼æ‰€æœ‰æŠ¥å‘Šå·²ç”Ÿæˆï¼ŒæŸ¥çœ‹ç´¢å¼•é¡µ: {index_html_path}")







